<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fff;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* å·¦ä¾§è¾¹æ  */
        .sidebar {
            width: 260px;
            background: #f9f9f9;
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .sidebar-header {
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #10a37f, #1a7f64);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .sidebar-toggle {
            width: 32px;
            height: 32px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .sidebar-toggle:hover {
            background: #f0f0f0;
        }

        .sidebar-menu {
            padding: 8px 12px;
            flex: 1;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #333;
            font-size: 14px;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: #ececec;
        }

        .menu-item-icon {
            width: 20px;
            text-align: center;
            color: #666;
        }

        .menu-divider {
            height: 1px;
            background: #e5e5e5;
            margin: 8px 0;
        }

        /* æœç´¢æ¡† */
        .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin: 8px 12px;
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 13px;
            background: transparent;
        }

        .search-box input::placeholder {
            color: #999;
        }

        /* èŠå¤©å†å²è®°å½• */
        .chat-history-section {
            margin-top: 8px;
        }

        .chat-history-title {
            font-size: 11px;
            color: #888;
            padding: 8px 12px 4px;
            text-transform: uppercase;
        }

        .chat-history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #333;
            font-size: 13px;
            transition: background 0.2s;
            margin: 2px 0;
        }

        .chat-history-item:hover {
            background: #ececec;
        }

        .chat-history-item.active {
            background: #e8e8e8;
        }

        .chat-history-item .chat-icon {
            font-size: 14px;
        }

        .chat-history-item .chat-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-history-item .chat-actions {
            display: none;
            gap: 4px;
        }

        .chat-history-item:hover .chat-actions {
            display: flex;
        }

        .chat-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
        }

        .chat-action-btn:hover {
            background: #ddd;
        }

        /* ç”¨æˆ·ä¿¡æ¯ */
        .user-section {
            padding: 12px;
            border-top: 1px solid #e5e5e5;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }

        .user-info:hover {
            background: #ececec;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .user-plan {
            font-size: 12px;
            color: #666;
        }

        /* ç”¨æˆ·ä¸‹æ‹‰èœå• */
        .user-dropdown {
            position: absolute;
            bottom: 70px;
            left: 12px;
            width: 236px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
            display: none;
            z-index: 1000;
        }

        .user-dropdown.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        .dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 12px 12px;
        }

        .dropdown-icon {
            width: 20px;
            text-align: center;
            color: #666;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .model-selector {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .model-selector:hover {
            background: #f5f5f5;
        }

        .model-name {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .model-hint {
            color: #c4820e;
            font-size: 14px;
        }

        .model-arrow {
            color: #666;
            font-size: 12px;
        }

        /* æ¨¡å‹ä¸‹æ‹‰èœå• */
        .model-dropdown {
            position: absolute;
            top: 50px;
            left: 16px;
            width: 320px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            display: none;
            z-index: 1000;
            max-height: 500px;
            overflow-y: auto;
        }

        .model-dropdown.show {
            display: block;
        }

        .dropdown-header {
            padding: 12px 16px;
            font-size: 12px;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .model-option {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .model-option:hover {
            background: #f5f5f5;
        }

        .model-option.active {
            background: #f8f8f8;
        }

        .model-option-content {
            flex: 1;
        }

        .model-option-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }

        .model-option-desc {
            font-size: 12px;
            color: #888;
        }

        .model-option-check {
            color: #10a37f;
            font-size: 16px;
        }

        .model-category {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: background 0.2s;
        }

        .model-category:hover {
            background: #f5f5f5;
        }

        .category-arrow {
            color: #666;
        }

        .top-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
            transition: background 0.2s;
        }

        .action-btn:hover {
            background: #f5f5f5;
        }

        .func-menu-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .func-menu-btn:hover {
            background: #f5f5f5;
        }

        /* åŠŸèƒ½èœå•ä¸‹æ‹‰ */
        .func-dropdown {
            position: absolute;
            top: 50px;
            right: 16px;
            width: 200px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
            display: none;
            z-index: 1000;
        }

        .func-dropdown.show {
            display: block;
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-area.has-messages {
            justify-content: flex-start;
            padding-top: 40px;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 30px;
        }

        /* æ¶ˆæ¯å®¹å™¨ */
        .messages-container {
            width: 100%;
            max-width: 768px;
            margin: 0 auto;
            display: none;
        }

        .messages-container.show {
            display: block;
        }

        .message {
            padding: 16px 0;
            display: flex;
            gap: 16px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message-avatar.user {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .message-avatar.assistant {
            background: linear-gradient(135deg, #10a37f, #1a7f64);
            color: white;
        }

        .message-content {
            flex: 1;
            line-height: 1.6;
            color: #333;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .message-content.loading::after {
            content: 'â—â—â—';
            animation: loading 1s infinite;
        }

        @keyframes loading {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .input-container {
            width: 100%;
            max-width: 768px;
            position: relative;
        }

        .input-box {
            display: flex;
            align-items: center;
            background: #f4f4f4;
            border-radius: 24px;
            padding: 8px 16px;
            gap: 12px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .input-box:focus-within {
            background: white;
            border-color: #10a37f;
            box-shadow: 0 0 0 2px rgba(16,163,127,0.1);
        }

        .input-prefix {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            cursor: pointer;
        }

        .input-field {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 15px;
            outline: none;
            padding: 8px 0;
            resize: none;
            max-height: 200px;
            line-height: 1.5;
        }

        .input-field::placeholder {
            color: #999;
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            transition: all 0.2s;
        }

        .input-action-btn:hover {
            background: #e5e5e5;
        }

        .input-action-btn.send {
            background: #10a37f;
            color: white;
        }

        .input-action-btn.send:hover {
            background: #0d8a6a;
        }

        .input-action-btn.send:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .welcome-title {
                font-size: 24px;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ccc;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e5;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            color: #666;
        }

        .modal-close:hover {
            background: #f0f0f0;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        .form-input:focus {
            border-color: #10a37f;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: #10a37f;
            color: white;
        }

        .btn-primary:hover {
            background: #0d8a6a;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e5e5e5;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: #333;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #10a37f;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* æ·±è‰²æ¨¡å¼ */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }
        body.dark-mode .sidebar {
            background: #202020;
            border-color: #333;
        }
        body.dark-mode .main-content {
            background: #1a1a1a;
        }
        body.dark-mode .chat-area {
            background: #1a1a1a;
        }
        body.dark-mode .input-container {
            background: #2d2d2d;
            border-color: #444;
        }
        body.dark-mode .input-container:focus-within {
            border-color: #10a37f;
        }
        body.dark-mode #messageInput {
            background: transparent;
            color: #e0e0e0;
        }
        body.dark-mode .menu-item,
        body.dark-mode .chat-history-item {
            color: #e0e0e0;
        }
        body.dark-mode .menu-item:hover,
        body.dark-mode .chat-history-item:hover {
            background: #333;
        }
        body.dark-mode .chat-history-item.active {
            background: #3a3a3a;
        }
        body.dark-mode .search-box {
            background: #2d2d2d;
            border-color: #444;
        }
        body.dark-mode .search-box input {
            color: #e0e0e0;
        }
        body.dark-mode .message.assistant .message-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }
        body.dark-mode .modal {
            background: #2d2d2d;
            color: #e0e0e0;
        }
        body.dark-mode .modal-header {
            border-color: #444;
        }
        body.dark-mode .modal-footer {
            border-color: #444;
        }
        body.dark-mode .form-input {
            background: #1a1a1a;
            border-color: #444;
            color: #e0e0e0;
        }
        body.dark-mode .form-label {
            color: #ccc;
        }
        body.dark-mode .setting-item {
            border-color: #444;
        }
        body.dark-mode .setting-label {
            color: #e0e0e0;
        }
        body.dark-mode .btn-secondary {
            background: #444;
            color: #e0e0e0;
        }
        body.dark-mode .user-dropdown {
            background: #2d2d2d;
            border-color: #444;
        }
        body.dark-mode .dropdown-item:hover {
            background: #3a3a3a;
        }
        body.dark-mode .welcome-title {
            color: #e0e0e0;
        }
        body.dark-mode .top-bar {
            border-color: #333;
        }
        body.dark-mode .model-display {
            color: #e0e0e0;
        }
        body.dark-mode .func-dropdown {
            background: #2d2d2d;
            border-color: #444;
        }
        body.dark-mode .func-dropdown-item:hover {
            background: #3a3a3a;
        }
        body.dark-mode .func-dropdown-title {
            color: #888;
        }
        body.dark-mode .dropdown-item {
            color: #e0e0e0;
        }
        body.dark-mode .user-name {
            color: #e0e0e0;
        }
        body.dark-mode .user-plan {
            color: #888;
        }
        body.dark-mode .sidebar-toggle {
            background: #333;
            border-color: #444;
            color: #e0e0e0;
        }
        body.dark-mode .menu-divider {
            background: #444;
        }
        body.dark-mode .chat-history-title {
            color: #888;
        }
        body.dark-mode .modal-title {
            color: #e0e0e0;
        }
        body.dark-mode .modal-close {
            color: #888;
        }
        body.dark-mode .modal-close:hover {
            color: #e0e0e0;
        }
        body.dark-mode #messageInput::placeholder {
            color: #666;
        }
        body.dark-mode .search-box input::placeholder {
            color: #666;
        }
        body.dark-mode .form-input::placeholder {
            color: #666;
        }
        body.dark-mode .func-dropdown-item {
            color: #e0e0e0;
        }
        body.dark-mode select.form-input {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        /* å¿«æ·æç¤ºè¯ */
        .quick-prompts {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding: 0 20px;
        }
        .quick-prompt-btn {
            padding: 10px 18px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            color: #333;
        }
        .quick-prompt-btn:hover {
            background: #10a37f;
            color: white;
            border-color: #10a37f;
            transform: translateY(-2px);
        }
        body.dark-mode .quick-prompt-btn {
            background: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }
        body.dark-mode .quick-prompt-btn:hover {
            background: #10a37f;
            color: white;
        }
        .chat-area.has-messages .quick-prompts {
            display: none;
        }

        /* æ¶ˆæ¯å¤åˆ¶æŒ‰é’® */
        .message-actions {
            display: none;
            position: absolute;
            right: 0;
            top: -24px;
            gap: 4px;
        }
        .message:hover .message-actions {
            display: flex;
        }
        .message {
            position: relative;
        }
        .msg-action-btn {
            padding: 4px 8px;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            color: #666;
        }
        .msg-action-btn:hover {
            background: #e0e0e0;
        }
        body.dark-mode .msg-action-btn {
            background: #3a3a3a;
            color: #ccc;
        }
        body.dark-mode .msg-action-btn:hover {
            background: #444;
        }

        /* ä¾§è¾¹æ æŠ˜å  */
        .sidebar.collapsed {
            width: 60px;
        }
        .sidebar.collapsed .sidebar-menu,
        .sidebar.collapsed .user-section {
            display: none;
        }
        .sidebar.collapsed .sidebar-header {
            justify-content: center;
        }
        .sidebar.collapsed .logo {
            display: none;
        }

        /* æ‰“å­—æœºå…‰æ ‡ */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background: #10a37f;
            margin-left: 2px;
            animation: blink 0.8s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">Q</div>
            </div>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="æŠ˜å ä¾§è¾¹æ ">â˜°</button>
        </div>

        <div class="sidebar-menu">
            <div class="menu-item" onclick="createNewChat()">
                <span class="menu-item-icon">âœï¸</span>
                <span>åˆ›å»ºæ–°èŠå¤©</span>
            </div>
            
            <div class="search-box">
                <span>ğŸ”</span>
                <input type="text" placeholder="æœç´¢èŠå¤©è®°å½•..." id="searchInput" oninput="searchChats(this.value)">
            </div>
            
            <div class="menu-divider"></div>
            
            <div class="menu-item" onclick="selectModel('doubao')">
                <span class="menu-item-icon">ğŸ¤–</span>
                <span>æ™ºèƒ½é—®ç­”</span>
            </div>
            
            <!-- èŠå¤©å†å²è®°å½• -->
            <div class="chat-history-section" id="chatHistorySection">
                <div class="chat-history-title">èŠå¤©è®°å½•</div>
                <!-- èŠå¤©è®°å½•ç”±JSåŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>

        <div class="user-section" id="userSection">
            <div class="user-info" id="loggedInUser" onclick="toggleUserDropdown()" style="display:none;">
                <div class="user-avatar" id="userAvatarDisplay">U</div>
                <div class="user-details">
                    <div class="user-name" id="userNameDisplay">User</div>
                    <div class="user-plan">åœ¨çº¿</div>
                </div>
            </div>
            <div class="menu-item" id="loginBtn" onclick="showLoginModal()">
                <span class="menu-item-icon">ğŸ”‘</span>
                <span>ç™»å½• / æ³¨å†Œ</span>
            </div>
        </div>

        <div class="user-dropdown" id="userDropdown">
            <div class="dropdown-item" onclick="showProfileModal()">
                <span class="dropdown-icon">ğŸ‘¤</span>
                <span>ä¸ªäººä¿¡æ¯</span>
            </div>
            <div class="dropdown-item" onclick="showSettingsModal()">
                <span class="dropdown-icon">âš™ï¸</span>
                <span>è®¾ç½®</span>
            </div>
            <div class="dropdown-item" id="adminEntry" style="display:none;" onclick="goToAdmin()">
                <span class="dropdown-icon">ğŸ“Š</span>
                <span>åå°ç®¡ç†</span>
            </div>
            <div class="dropdown-item" onclick="logout()">
                <span class="dropdown-icon">ğŸšª</span>
                <span>é€€å‡ºç™»å½•</span>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ³¨å†Œå¼¹çª— -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="authModalTitle">ç™»å½•</span>
                <button class="modal-close" onclick="closeModal('loginModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="loginForm">
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·å</label>
                        <input type="text" class="form-input" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¯†ç </label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <div style="text-align:center;margin-top:16px;">
                        <span style="color:#666;font-size:13px;">æ²¡æœ‰è´¦å·ï¼Ÿ</span>
                        <a href="javascript:void(0)" onclick="switchToRegister()" style="color:#10a37f;font-size:13px;">ç«‹å³æ³¨å†Œ</a>
                    </div>
                </div>
                <div id="registerForm" style="display:none;">
                    <div class="form-group">
                        <label class="form-label">ç”¨æˆ·å</label>
                        <input type="text" class="form-input" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¯†ç </label>
                        <input type="password" class="form-input" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç¡®è®¤å¯†ç </label>
                        <input type="password" class="form-input" id="regPassword2" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                    </div>
                    <div style="text-align:center;margin-top:16px;">
                        <span style="color:#666;font-size:13px;">å·²æœ‰è´¦å·ï¼Ÿ</span>
                        <a href="javascript:void(0)" onclick="switchToLogin()" style="color:#10a37f;font-size:13px;">è¿”å›ç™»å½•</a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('loginModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="authSubmitBtn" onclick="submitLogin()">ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- ä¸ªäººä¿¡æ¯å¼¹çª— -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ä¸ªäººä¿¡æ¯</span>
                <button class="modal-close" onclick="closeModal('profileModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-input" id="profileName" value="User">
                </div>
                <div class="form-group">
                    <label class="form-label">å¤´åƒ</label>
                    <div style="display:flex;gap:10px;margin-top:8px;">
                        <div class="user-avatar avatar-option" style="cursor:pointer;" onclick="selectAvatar(this,'U')">U</div>
                        <div class="user-avatar avatar-option" style="cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);" onclick="selectAvatar(this,'A')">A</div>
                        <div class="user-avatar avatar-option" style="cursor:pointer;background:linear-gradient(135deg,#f093fb,#f5576c);" onclick="selectAvatar(this,'B')">B</div>
                        <div class="user-avatar avatar-option" style="cursor:pointer;background:linear-gradient(135deg,#4facfe,#00f2fe);" onclick="selectAvatar(this,'C')">C</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('profileModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveProfile()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">è®¾ç½®</span>
                <button class="modal-close" onclick="closeModal('settingsModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <span class="setting-label">æ·±è‰²æ¨¡å¼</span>
                    <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                </div>
                <div class="setting-item">
                    <span class="setting-label">æ¶ˆæ¯æç¤ºéŸ³</span>
                    <div class="toggle-switch active" id="soundToggle" onclick="toggleSound()"></div>
                </div>
                <div class="setting-item">
                    <span class="setting-label">è‡ªåŠ¨ä¿å­˜å¯¹è¯</span>
                    <div class="toggle-switch active" id="autoSaveToggle" onclick="toggleAutoSave()"></div>
                </div>
                <div class="setting-item">
                    <span class="setting-label">é»˜è®¤æ¨¡å¼</span>
                    <select class="form-input" style="width:auto;" id="defaultModeSelect">
                        <option value="doubao">è±†åŒ…æ™ºèƒ½å¯¹è¯</option>
                        <option value="deepseek">DeepSeekæ™ºèƒ½å¯¹è¯</option>
                        <option value="local">æœ¬åœ°èŠå¤©æ¨¡å‹</option>
                        <option value="classify">æ–‡æœ¬åˆ†ç±»</option>
                        <option value="sentiment">æƒ…æ„Ÿåˆ†æ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="model-selector" onclick="toggleModelDropdown()">
                <span class="model-name" id="currentModelName">æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</span>
                <span class="model-hint" id="modelHint">[ç‚¹æ­¤å¯åˆ‡æ¢æ¨¡å‹]</span>
                <span class="model-arrow">â–¼</span>
            </div>

            <div class="top-actions">
                <button class="action-btn" title="åˆ·æ–°" onclick="location.reload()">ğŸ”„</button>
                <button class="func-menu-btn" onclick="toggleFuncDropdown()">
                    <span>â‹®</span>
                    <span>åŠŸèƒ½é€‰å•</span>
                </button>
            </div>
        </div>

        <!-- æ¨¡å‹ä¸‹æ‹‰èœå• -->
        <div class="model-dropdown" id="modelDropdown">
            <div class="dropdown-header">
                <span>æ¨¡å‹</span>
                <span>â„¹ï¸</span>
            </div>
            <div class="model-option active" data-mode="doubao" onclick="selectModel('doubao')">
                <div class="model-option-content">
                    <div class="model-option-title">ğŸŒŸ è±†åŒ…æ™ºèƒ½å¯¹è¯</div>
                    <div class="model-option-desc">åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼Œæ™ºèƒ½é—®ç­”</div>
                </div>
                <span class="model-option-check" id="check-doubao">âœ“</span>
            </div>
            <div class="model-option" data-mode="deepseek" onclick="selectModel('deepseek')">
                <div class="model-option-content">
                    <div class="model-option-title">ğŸ”¥ DeepSeekæ™ºèƒ½å¯¹è¯</div>
                    <div class="model-option-desc">DeepSeek V3å¤§æ¨¡å‹</div>
                </div>
                <span class="model-option-check" id="check-deepseek" style="display:none">âœ“</span>
            </div>
            <div class="model-option" data-mode="local" onclick="selectModel('local')">
                <div class="model-option-content">
                    <div class="model-option-title">ğŸ’» æœ¬åœ°èŠå¤©æ¨¡å‹</div>
                    <div class="model-option-desc">ä½¿ç”¨æœ¬åœ°è®­ç»ƒçš„æ¨¡å‹</div>
                </div>
                <span class="model-option-check" id="check-local" style="display:none">âœ“</span>
            </div>
            <div class="menu-divider"></div>
            <div class="model-category" onclick="selectModel('classify')">
                <span>ğŸ“ æ–‡æœ¬åˆ†ç±»</span>
                <span class="category-arrow">â€º</span>
            </div>
            <div class="model-category" onclick="selectModel('sentiment')">
                <span>ğŸ’­ æƒ…æ„Ÿåˆ†æ</span>
                <span class="category-arrow">â€º</span>
            </div>
            <div class="model-category" onclick="selectModel('multi_analysis')">
                <span>ğŸ“‹ ç»¼åˆåˆ†æ</span>
                <span class="category-arrow">â€º</span>
            </div>
            <div class="menu-divider"></div>
            <div class="model-category" onclick="selectModel('translate_zh2en')">
                <span>ğŸ‡¨ğŸ‡³â†’ğŸ‡¬ğŸ‡§ ä¸­è¯‘è‹±</span>
                <span class="category-arrow">â€º</span>
            </div>
            <div class="model-category" onclick="selectModel('translate_en2zh')">
                <span>ğŸ‡¬ğŸ‡§â†’ğŸ‡¨ğŸ‡³ è‹±è¯‘ä¸­</span>
                <span class="category-arrow">â€º</span>
            </div>
        </div>

        <!-- åŠŸèƒ½ä¸‹æ‹‰èœå• -->
        <div class="func-dropdown" id="funcDropdown">
            <div class="dropdown-item" onclick="clearChat()">
                <span class="dropdown-icon">ğŸ—‘ï¸</span>
                <span>æ¸…ç©ºå¯¹è¯</span>
            </div>
            <div class="dropdown-item" onclick="checkStatus()">
                <span class="dropdown-icon">ğŸ“Š</span>
                <span>æœåŠ¡çŠ¶æ€</span>
            </div>
        </div>

        <!-- èŠå¤©åŒºåŸŸ -->
        <div class="chat-area" id="chatArea">
            <h1 class="welcome-title" id="welcomeTitle">æœ‰ä»€ä¹ˆå¯ä»¥å¸®å¿™çš„?</h1>
            
            <!-- å¿«æ·æç¤ºè¯ -->
            <div class="quick-prompts" id="quickPrompts">
                <button class="quick-prompt-btn" onclick="usePrompt('ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±')">ğŸ‘‹ ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±</button>
                <button class="quick-prompt-btn" onclick="usePrompt('å¸®æˆ‘å†™ä¸€æ®µPythonä»£ç ')">ğŸ’» å†™ä¸€æ®µä»£ç </button>
                <button class="quick-prompt-btn" onclick="usePrompt('ç»™æˆ‘æ¨èä¸€éƒ¨ç”µå½±')">ğŸ¬ æ¨èç”µå½±</button>
                <button class="quick-prompt-btn" onclick="usePrompt('ç»™æˆ‘è®²ä¸ªç¬‘è¯')">ğŸ˜„ è®²ä¸ªç¬‘è¯</button>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
            </div>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-area">
            <div class="input-container">
                <div class="input-box">
                    <div class="input-prefix">+</div>
                    <textarea class="input-field" id="messageInput" placeholder="è¯¢é—®ä»»ä½•é—®é¢˜" rows="1" onkeydown="handleKeyDown(event)"></textarea>
                    <div class="input-actions">
                        <button class="input-action-btn" title="è¯­éŸ³">ğŸ¤</button>
                        <button class="input-action-btn send" id="sendBtn" onclick="sendMessage()" title="å‘é€">â¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/jquery-latest.js"></script>
    <script>
        // å½“å‰æ¨¡å¼
        window.currentMode = 'doubao';

        // æ¨¡å¼åç§°æ˜ å°„
        const modeNames = {
            'doubao': 'ğŸŒŸ è±†åŒ…æ™ºèƒ½å¯¹è¯',
            'deepseek': 'ğŸ”¥ DeepSeekæ™ºèƒ½å¯¹è¯',
            'local': 'ğŸ’» æœ¬åœ°èŠå¤©æ¨¡å‹',
            'classify': 'ğŸ“ æ–‡æœ¬åˆ†ç±»',
            'sentiment': 'ğŸ’­ æƒ…æ„Ÿåˆ†æ',
            'translate_zh2en': 'ğŸ‡¨ğŸ‡³â†’ğŸ‡¬ğŸ‡§ ä¸­è¯‘è‹±',
            'translate_en2zh': 'ğŸ‡¬ğŸ‡§â†’ğŸ‡¨ğŸ‡³ è‹±è¯‘ä¸­',
            'multi_analysis': 'ğŸ“‹ ç»¼åˆåˆ†æ'
        };

        const modePlaceholders = {
            'doubao': 'è¯¢é—®ä»»ä½•é—®é¢˜',
            'deepseek': 'ä½¿ç”¨DeepSeekå¯¹è¯',
            'local': 'ä½¿ç”¨æœ¬åœ°æ¨¡å‹å¯¹è¯',
            'classify': 'è¾“å…¥æ–°é—»æ–‡æœ¬è¿›è¡Œåˆ†ç±»',
            'sentiment': 'è¾“å…¥æ–‡æœ¬åˆ†ææƒ…æ„Ÿ',
            'translate_zh2en': 'è¾“å…¥ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡',
            'translate_en2zh': 'Enter English to translate',
            'multi_analysis': 'è¾“å…¥æ–‡æœ¬è¿›è¡Œç»¼åˆåˆ†æ'
        };

        // åˆ‡æ¢æ¨¡å‹ä¸‹æ‹‰
        function toggleModelDropdown() {
            document.getElementById('modelDropdown').classList.toggle('show');
            document.getElementById('funcDropdown').classList.remove('show');
            document.getElementById('userDropdown').classList.remove('show');
        }

        // åˆ‡æ¢åŠŸèƒ½ä¸‹æ‹‰
        function toggleFuncDropdown() {
            document.getElementById('funcDropdown').classList.toggle('show');
            document.getElementById('modelDropdown').classList.remove('show');
            document.getElementById('userDropdown').classList.remove('show');
        }

        // åˆ‡æ¢ç”¨æˆ·ä¸‹æ‹‰
        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
            document.getElementById('modelDropdown').classList.remove('show');
            document.getElementById('funcDropdown').classList.remove('show');
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.model-selector') && !e.target.closest('.model-dropdown')) {
                document.getElementById('modelDropdown').classList.remove('show');
            }
            if (!e.target.closest('.func-menu-btn') && !e.target.closest('.func-dropdown')) {
                document.getElementById('funcDropdown').classList.remove('show');
            }
            if (!e.target.closest('.user-info') && !e.target.closest('.user-dropdown')) {
                document.getElementById('userDropdown').classList.remove('show');
            }
        });

        // é€‰æ‹©æ¨¡å‹
        function selectModel(mode) {
            const previousMode = window.currentMode;
            window.currentMode = mode;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('currentModelName').textContent = modeNames[mode] || mode;
            document.getElementById('modelHint').textContent = '[ç‚¹æ­¤å¯åˆ‡æ¢æ¨¡å‹]';
            document.getElementById('messageInput').placeholder = modePlaceholders[mode] || 'è¯¢é—®ä»»ä½•é—®é¢˜';
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.model-option-check').forEach(el => el.style.display = 'none');
            const checkEl = document.getElementById('check-' + mode);
            if (checkEl) checkEl.style.display = 'inline';
            
            document.querySelectorAll('.model-option').forEach(el => el.classList.remove('active'));
            const activeOption = document.querySelector(`.model-option[data-mode="${mode}"]`);
            if (activeOption) activeOption.classList.add('active');
            
            // å…³é—­ä¸‹æ‹‰
            document.getElementById('modelDropdown').classList.remove('show');
            
            // å¦‚æœæ¨¡å¼å‘ç”Ÿå˜åŒ–ä¸”å½“å‰æœ‰æ¶ˆæ¯ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°èŠå¤©
            if (previousMode && previousMode !== mode) {
                const messagesContainer = document.getElementById('messagesContainer');
                const hasMessages = messagesContainer.querySelector('.message');
                
                if (hasMessages && currentUser) {
                    // ä¿å­˜å½“å‰èŠå¤©
                    const messages = [];
                    document.querySelectorAll('#messagesContainer .message').forEach(msg => {
                        const role = msg.querySelector('.message-avatar').classList.contains('user') ? 'user' : 'assistant';
                        const text = msg.querySelector('.message-content').textContent;
                        messages.push({role, text});
                    });
                    
                    if (messages.length > 0 && currentChatId) {
                        // æ›´æ–°å½“å‰èŠå¤©çš„æ¶ˆæ¯
                        chatHistories[currentChatId].messages = messages;
                        saveUserChats();
                    }
                    
                    // åˆ›å»ºæ–°èŠå¤©
                    createNewChatForMode(mode);
                }
            }
        }
        
        // ä¸ºæ–°æ¨¡å¼åˆ›å»ºæ–°èŠå¤©
        function createNewChatForMode(mode) {
            // æ¸…ç©ºå½“å‰å¯¹è¯
            clearChat();
            
            // å–æ¶ˆæ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.chat-history-item').forEach(el => el.classList.remove('active'));
            
            // åˆ›å»ºæ–°èŠå¤©ID
            currentChatId = chatIdCounter++;
            
            // ç”ŸæˆèŠå¤©æ ‡é¢˜
            const title = `${modeNames[mode]} - ${new Date().toLocaleString('zh-CN', {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'})}`;
            
            // ä¿å­˜åˆ°å†å²è®°å½•
            chatHistories[currentChatId] = {
                title: title,
                mode: mode,
                messages: []
            };
            
            // æ·»åŠ åˆ°ä¾§è¾¹æ 
            addChatToSidebar(currentChatId, title);
            
            // åŒæ­¥åˆ°åç«¯
            saveUserChats();
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const msg = input.value.trim();
            if (!msg) return;

            // æ˜¾ç¤ºæ¶ˆæ¯åŒºåŸŸï¼Œéšè—æ¬¢è¿è¯­
            document.getElementById('welcomeTitle').style.display = 'none';
            document.getElementById('messagesContainer').classList.add('show');
            document.getElementById('chatArea').classList.add('has-messages');

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(msg, 'user');
            input.value = '';
            input.style.height = 'auto';

            // æ·»åŠ åŠ è½½æ¶ˆæ¯
            const loadingId = 'loading-' + Date.now();
            addMessage('', 'assistant', loadingId, true);

            // å‘é€è¯·æ±‚
            $.post('/message', {
                msg: msg,
                mode: window.currentMode
            }).done(function(reply) {
                // ç§»é™¤åŠ è½½æ¶ˆæ¯ï¼Œæ·»åŠ å›å¤ï¼ˆå¸¦æ‰“å­—æœºæ•ˆæœï¼‰
                document.getElementById(loadingId)?.remove();
                addMessage(reply.text || 'æœªæ”¶åˆ°å›å¤', 'assistant', null, false, true);
                
                // æ’­æ”¾æç¤ºéŸ³
                playNotificationSound();
                
                // ä¿å­˜åˆ°å†å²è®°å½•ï¼ˆæ ¹æ®è®¾ç½®ï¼‰
                if (settings.autoSave) {
                    saveCurrentChat(msg);
                }
            }).fail(function(xhr) {
                document.getElementById(loadingId)?.remove();
                let errorMsg = 'è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                if (xhr.status === 0) errorMsg = 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨';
                else if (xhr.status === 500) errorMsg = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯';
                addMessage('âš ï¸ ' + errorMsg, 'assistant');
            });
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(text, role, id, isLoading, useTypewriter) {
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = 'message';
            if (id) div.id = id;

            const avatarClass = role === 'user' ? 'user' : 'assistant';
            const avatarContent = role === 'user' ? 'U' : 'ğŸ¤–';

            div.innerHTML = `
                <div class="message-avatar ${avatarClass}">${avatarContent}</div>
                <div class="message-content ${isLoading ? 'loading' : ''}">${isLoading ? '' : escapeHtml(text)}</div>
                ${!isLoading ? '<div class="message-actions"><button class="msg-action-btn" onclick="copyMessage(this)">ğŸ“‹ å¤åˆ¶</button></div>' : ''}
            `;

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            
            // æ‰“å­—æœºæ•ˆæœï¼ˆä»…AIå›å¤ï¼‰
            if (useTypewriter && role === 'assistant' && !isLoading && text) {
                typewriterEffect(div.querySelector('.message-content'), text);
            }
        }
        
        // æ‰“å­—æœºæ•ˆæœ
        function typewriterEffect(element, text) {
            element.innerHTML = '<span class="typing-cursor"></span>';
            let i = 0;
            const escaped = escapeHtml(text);
            const interval = setInterval(() => {
                if (i < escaped.length) {
                    element.innerHTML = escaped.substring(0, i + 1) + '<span class="typing-cursor"></span>';
                    i++;
                    element.parentElement.parentElement.scrollTop = element.parentElement.parentElement.scrollHeight;
                } else {
                    element.innerHTML = escaped;
                    clearInterval(interval);
                }
            }, 20);
        }

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å¤åˆ¶æ¶ˆæ¯
        function copyMessage(btn) {
            const content = btn.closest('.message').querySelector('.message-content').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ… å·²å¤åˆ¶';
                setTimeout(() => btn.innerHTML = originalText, 1500);
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥');
            });
        }

        // ä½¿ç”¨å¿«æ·æç¤ºè¯
        function usePrompt(prompt) {
            document.getElementById('messageInput').value = prompt;
            sendMessage();
        }

        // ä¾§è¾¹æ æŠ˜å 
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
        }

        // é”®ç›˜äº‹ä»¶
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 200) + 'px';
        });

        // æ¸…ç©ºå¯¹è¯
        function clearChat() {
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('messagesContainer').classList.remove('show');
            document.getElementById('welcomeTitle').style.display = 'block';
            document.getElementById('chatArea').classList.remove('has-messages');
            document.getElementById('funcDropdown').classList.remove('show');
        }

        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        function checkStatus() {
            $.get('/health').done(function(data) {
                alert('âœ… æœåŠ¡è¿è¡Œæ­£å¸¸\n' + JSON.stringify(data, null, 2));
            }).fail(function() {
                alert('âŒ æœåŠ¡å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨');
            });
            document.getElementById('funcDropdown').classList.remove('show');
        }

        // ==================== èŠå¤©å†å²åŠŸèƒ½ ====================
        
        // èŠå¤©è®°å½•å­˜å‚¨ï¼ˆæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ï¼‰
        let chatHistories = {};
        
        let currentChatId = null;
        let chatIdCounter = 1;

        // ä»åç«¯åŠ è½½ç”¨æˆ·çš„èŠå¤©è®°å½•
        function loadUserChats() {
            if (!currentUser) return;
            
            $.get('/api/chats/' + currentUser).done(function(res) {
                if (res.success && res.chats) {
                    // è½¬æ¢ä¸ºå¯¹è±¡æ ¼å¼
                    chatHistories = {};
                    res.chats.forEach(chat => {
                        chatHistories[chat.id] = chat;
                        if (chat.id >= chatIdCounter) {
                            chatIdCounter = chat.id + 1;
                        }
                    });
                    // æ¸²æŸ“ä¾§è¾¹æ 
                    renderChatHistory();
                }
            });
        }

        // ä¿å­˜ç”¨æˆ·çš„èŠå¤©è®°å½•åˆ°åç«¯
        function saveUserChats() {
            if (!currentUser) return;
            
            // è½¬æ¢ä¸ºæ•°ç»„æ ¼å¼
            const chatsArray = Object.entries(chatHistories).map(([id, chat]) => ({
                id: parseInt(id),
                ...chat
            }));
            
            $.ajax({
                url: '/api/chats/' + currentUser,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ chats: chatsArray })
            });
        }

        // æ¸²æŸ“ä¾§è¾¹æ èŠå¤©å†å²
        function renderChatHistory() {
            const section = document.getElementById('chatHistorySection');
            // æ¸…ç©ºç°æœ‰çš„èŠå¤©é¡¹
            section.querySelectorAll('.chat-history-item').forEach(el => el.remove());
            
            const todayTitle = section.querySelector('.chat-history-title');
            
            // æŒ‰IDå€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰ï¼Œåªæ˜¾ç¤ºæœ€è¿‘5æ¡
            const sortedChats = Object.entries(chatHistories).sort((a, b) => b[0] - a[0]).slice(0, 5);
            
            sortedChats.forEach(([chatId, chat]) => {
                const html = `
                    <div class="chat-history-item" data-chat-id="${chatId}" onclick="loadChat(${chatId})">
                        <span class="chat-icon">ğŸ’¬</span>
                        <span class="chat-title">${chat.title || 'æ–°å¯¹è¯'}</span>
                        <div class="chat-actions">
                            <button class="chat-action-btn" onclick="event.stopPropagation();deleteChat(${chatId})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
                todayTitle.insertAdjacentHTML('afterend', html);
            });
        }

        // åˆ›å»ºæ–°èŠå¤©
        function createNewChat() {
            // æ¸…ç©ºå½“å‰å¯¹è¯
            clearChat();
            
            // å–æ¶ˆæ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.chat-history-item').forEach(el => el.classList.remove('active'));
            
            // é‡ç½®ä¸ºé»˜è®¤æ¨¡å¼
            selectModel('doubao');
            
            currentChatId = null;
        }

        // åŠ è½½èŠå¤©è®°å½•
        function loadChat(chatId) {
            const chat = chatHistories[chatId];
            if (!chat) return;
            
            currentChatId = chatId;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.chat-history-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`[data-chat-id="${chatId}"]`)?.classList.add('active');
            
            // åˆ‡æ¢æ¨¡å¼
            selectModel(chat.mode);
            
            // æ¸…ç©ºå¹¶åŠ è½½æ¶ˆæ¯
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            if (chat.messages.length > 0) {
                document.getElementById('welcomeTitle').style.display = 'none';
                container.classList.add('show');
                document.getElementById('chatArea').classList.add('has-messages');
                
                chat.messages.forEach(msg => {
                    addMessage(msg.text, msg.role);
                });
            } else {
                document.getElementById('welcomeTitle').style.display = 'block';
                container.classList.remove('show');
                document.getElementById('chatArea').classList.remove('has-messages');
            }
        }

        // åˆ é™¤èŠå¤©è®°å½•
        function deleteChat(chatId) {
            if (!confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªèŠå¤©è®°å½•å—ï¼Ÿ')) return;
            
            // ä»å­˜å‚¨ä¸­åˆ é™¤
            delete chatHistories[chatId];
            
            // åŒæ­¥åˆ°åç«¯
            saveUserChats();
            
            // ä»ç•Œé¢ä¸­ç§»é™¤
            document.querySelector(`[data-chat-id="${chatId}"]`)?.remove();
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰èŠå¤©ï¼Œåˆ›å»ºæ–°èŠå¤©
            if (currentChatId === chatId) {
                createNewChat();
            }
        }

        // æœç´¢èŠå¤©è®°å½•
        function searchChats(keyword) {
            const items = document.querySelectorAll('.chat-history-item');
            keyword = keyword.toLowerCase();
            
            items.forEach(item => {
                const title = item.querySelector('.chat-title').textContent.toLowerCase();
                if (keyword === '' || title.includes(keyword)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ä¿å­˜å½“å‰å¯¹è¯åˆ°å†å²
        function saveCurrentChat(firstMessage) {
            if (!currentUser) return; // æœªç™»å½•ä¸ä¿å­˜
            
            // æ”¶é›†å½“å‰æ‰€æœ‰æ¶ˆæ¯
            const messages = [];
            document.querySelectorAll('#messagesContainer .message').forEach(msg => {
                const role = msg.querySelector('.message-avatar').classList.contains('user') ? 'user' : 'assistant';
                const text = msg.querySelector('.message-content').textContent;
                messages.push({role, text});
            });
            
            if (messages.length === 0) return;
            
            // ç”Ÿæˆæ ‡é¢˜ï¼ˆå–ç¬¬ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼‰
            const title = (firstMessage || messages[0].text).substring(0, 12) + ((firstMessage || messages[0].text).length > 12 ? '...' : '');
            
            if (!currentChatId) {
                // åˆ›å»ºæ–°çš„èŠå¤©è®°å½•
                currentChatId = chatIdCounter++;
                
                chatHistories[currentChatId] = {
                    title: title,
                    mode: window.currentMode,
                    messages: messages
                };
                
                // æ·»åŠ åˆ°ä¾§è¾¹æ 
                addChatToSidebar(currentChatId, title);
            } else {
                // æ›´æ–°ç°æœ‰è®°å½•
                chatHistories[currentChatId].messages = messages;
                
                // åŒæ—¶æ›´æ–°ä¾§è¾¹æ æ ‡é¢˜ï¼ˆå–æœ€æ–°çš„ç¬¬ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼‰
                const userMsgs = messages.filter(m => m.role === 'user');
                if (userMsgs.length > 0) {
                    const latestTitle = userMsgs[userMsgs.length - 1].text.substring(0, 12) + (userMsgs[userMsgs.length - 1].text.length > 12 ? '...' : '');
                    chatHistories[currentChatId].title = latestTitle;
                    const el = document.querySelector(`[data-chat-id="${currentChatId}"] .chat-title`);
                    if (el) el.textContent = latestTitle;
                }
            }
            
            // åŒæ­¥ä¿å­˜åˆ°åç«¯
            saveUserChats();
        }

        // æ·»åŠ èŠå¤©åˆ°ä¾§è¾¹æ 
        function addChatToSidebar(chatId, title) {
            const section = document.getElementById('chatHistorySection');
            const todayTitle = section.querySelector('.chat-history-title');
            
            const html = `
                <div class="chat-history-item active" data-chat-id="${chatId}" onclick="loadChat(${chatId})">
                    <span class="chat-icon">ğŸ’¬</span>
                    <span class="chat-title">${title}</span>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="event.stopPropagation();deleteChat(${chatId})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
            
            // æ’å…¥åˆ°"ä»Šå¤©"æ ‡é¢˜åé¢
            todayTitle.insertAdjacentHTML('afterend', html);
            
            // å–æ¶ˆå…¶ä»–é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.chat-history-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`[data-chat-id="${chatId}"]`)?.classList.add('active');
        }

        // ==================== ç”¨æˆ·è®¾ç½®åŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºä¸ªäººä¿¡æ¯å¼¹çª—
        function showProfileModal() {
            document.getElementById('userDropdown').classList.remove('show');
            if (currentUser) {
                document.getElementById('profileName').value = currentUser;
            }
            document.getElementById('profileModal').classList.add('show');
        }

        // æ˜¾ç¤ºè®¾ç½®å¼¹çª—
        function showSettingsModal() {
            document.getElementById('userDropdown').classList.remove('show');
            document.getElementById('settingsModal').classList.add('show');
        }

        // å…³é—­å¼¹çª—
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }



        // ==================== ç™»å½•æ³¨å†ŒåŠŸèƒ½ ====================
        
        let isLoggedIn = false;
        let currentUser = null;
        let currentUserRole = null;

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            // å…ˆåŠ è½½è®¾ç½®
            loadSettings();
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus();
            // åº”ç”¨é»˜è®¤æ¨¡å¼
            selectModel(settings.defaultMode);
            // ç»‘å®šé»˜è®¤æ¨¡å¼é€‰æ‹©å™¨äº‹ä»¶
            document.getElementById('defaultModeSelect').addEventListener('change', function() {
                settings.defaultMode = this.value;
                saveSettings();
            });
            document.getElementById('messageInput').focus();
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const userStr = localStorage.getItem('currentUser');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    isLoggedIn = true;
                    currentUser = user.username;
                    currentUserRole = user.role;
                    updateLoginState();
                    // åŠ è½½ç”¨æˆ·çš„èŠå¤©è®°å½•
                    loadUserChats();
                } catch(e) {
                    localStorage.removeItem('currentUser');
                }
            }
        }

        // æ˜¾ç¤ºç™»å½•å¼¹çª—
        function showLoginModal() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('authModalTitle').textContent = 'ç™»å½•';
            document.getElementById('authSubmitBtn').textContent = 'ç™»å½•';
            document.getElementById('authSubmitBtn').onclick = submitLogin;
            document.getElementById('loginModal').classList.add('show');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // åˆ‡æ¢åˆ°æ³¨å†Œ
        function switchToRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('authModalTitle').textContent = 'æ³¨å†Œ';
            document.getElementById('authSubmitBtn').textContent = 'æ³¨å†Œ';
            document.getElementById('authSubmitBtn').onclick = submitRegister;
        }

        // åˆ‡æ¢åˆ°ç™»å½•
        function switchToLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('authModalTitle').textContent = 'ç™»å½•';
            document.getElementById('authSubmitBtn').textContent = 'ç™»å½•';
            document.getElementById('authSubmitBtn').onclick = submitLogin;
        }

        // æäº¤ç™»å½• - ä½¿ç”¨åç«¯API
        function submitLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            $.ajax({
                url: '/api/login',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ username, password })
            }).done(function(res) {
                if (res.success) {
                    isLoggedIn = true;
                    currentUser = res.user.username;
                    currentUserRole = res.user.role;
                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('currentUser', JSON.stringify(res.user));
                    updateLoginState();
                    // åŠ è½½ç”¨æˆ·çš„èŠå¤©è®°å½•
                    loadUserChats();
                    closeModal('loginModal');
                    alert('âœ… ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ' + currentUser);
                } else {
                    alert('âŒ ' + res.message);
                }
            }).fail(function() {
                alert('âŒ ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
            });
        }

        // æäº¤æ³¨å†Œ - ä½¿ç”¨åç«¯API
        function submitRegister() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const password2 = document.getElementById('regPassword2').value;
            
            if (!username || !password) {
                alert('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            if (password !== password2) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            $.ajax({
                url: '/api/register',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ username, password })
            }).done(function(res) {
                if (res.success) {
                    isLoggedIn = true;
                    currentUser = res.user.username;
                    currentUserRole = res.user.role;
                    localStorage.setItem('currentUser', JSON.stringify(res.user));
                    updateLoginState();
                    // æ–°ç”¨æˆ·æ²¡æœ‰èŠå¤©è®°å½•ï¼Œæ¸…ç©ºæ˜¾ç¤º
                    chatHistories = {};
                    renderChatHistory();
                    closeModal('loginModal');
                    alert('âœ… æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿ï¼Œ' + currentUser);
                } else {
                    alert('âŒ ' + res.message);
                }
            }).fail(function() {
                alert('âŒ æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•');
            });
        }

        // æ›´æ–°ç™»å½•çŠ¶æ€UI
        function updateLoginState() {
            if (isLoggedIn && currentUser) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('loggedInUser').style.display = 'flex';
                document.getElementById('userNameDisplay').textContent = currentUser;
                document.getElementById('userAvatarDisplay').textContent = currentUser.charAt(0).toUpperCase();
                
                // åªæœ‰adminæ‰æ˜¾ç¤ºåå°ç®¡ç†å…¥å£
                if (currentUserRole === 'admin') {
                    document.getElementById('adminEntry').style.display = 'flex';
                } else {
                    document.getElementById('adminEntry').style.display = 'none';
                }
            } else {
                document.getElementById('loginBtn').style.display = 'flex';
                document.getElementById('loggedInUser').style.display = 'none';
                document.getElementById('adminEntry').style.display = 'none';
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                isLoggedIn = false;
                currentUser = null;
                currentUserRole = null;
                localStorage.removeItem('currentUser');
                updateLoginState();
                // æ¸…ç©ºèŠå¤©å†å²
                chatHistories = {};
                currentChatId = null;
                chatIdCounter = 1;
                renderChatHistory();
                clearChat();
                document.getElementById('userDropdown').classList.remove('show');
                alert('å·²é€€å‡ºç™»å½•');
            }
        }

        // è¿›å…¥åå°ç®¡ç†
        function goToAdmin() {
            if (currentUserRole !== 'admin') {
                alert('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®åå°ç®¡ç†');
                return;
            }
            window.location.href = '/admin';
        }

        // ==================== å¯¼å‡ºå’Œæ¸…ç©ºåŠŸèƒ½ ====================

        // å¯¼å‡ºèŠå¤©æ•°æ®
        function exportChats() {
            const data = JSON.stringify(chatHistories, null, 2);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chat_history_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… æ•°æ®å·²å¯¼å‡º');
        }

        // æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•
        function clearAllChats() {
            if (confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                chatHistories = {};
                currentChatId = null;
                chatIdCounter = 1;
                
                // æ¸…ç©ºä¾§è¾¹æ 
                document.querySelectorAll('.chat-history-item').forEach(el => el.remove());
                
                // æ¸…ç©ºå½“å‰å¯¹è¯
                clearChat();
                
                alert('âœ… æ‰€æœ‰èŠå¤©è®°å½•å·²æ¸…ç©º');
            }
        }

        // ==================== ä¸ªäººä¿¡æ¯åŠŸèƒ½ ====================
        
        // é€‰æ‹©å¤´åƒ
        let selectedAvatar = 'U';
        let selectedAvatarBg = 'linear-gradient(135deg, #ff6b6b, #ee5a5a)';
        
        function selectAvatar(el, letter) {
            selectedAvatar = letter;
            selectedAvatarBg = el.style.background || 'linear-gradient(135deg, #ff6b6b, #ee5a5a)';
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.avatar-option').forEach(a => a.style.outline = 'none');
            el.style.outline = '3px solid #10a37f';
        }

        // ä¿å­˜ä¸ªäººä¿¡æ¯
        function saveProfile() {
            const name = document.getElementById('profileName').value.trim();
            if (name && currentUser) {
                currentUser = name;
                document.getElementById('userNameDisplay').textContent = name;
                document.getElementById('userAvatarDisplay').textContent = selectedAvatar;
                document.getElementById('userAvatarDisplay').style.background = selectedAvatarBg;
            }
            closeModal('profileModal');
            alert('âœ… ä¸ªäººä¿¡æ¯å·²ä¿å­˜');
        }

        // ==================== è®¾ç½®åŠŸèƒ½ ====================
        
        // è®¾ç½®é¡¹
        let settings = {
            darkMode: false,
            sound: false,
            autoSave: true,
            defaultMode: 'doubao'
        };

        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const saved = localStorage.getItem('appSettings');
            if (saved) {
                try {
                    settings = { ...settings, ...JSON.parse(saved) };
                } catch(e) {}
            }
            applySettings();
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            localStorage.setItem('appSettings', JSON.stringify(settings));
        }

        // åº”ç”¨è®¾ç½®
        function applySettings() {
            // æ·±è‰²æ¨¡å¼
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').classList.add('active');
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('darkModeToggle').classList.remove('active');
            }
            
            // æç¤ºéŸ³
            if (settings.sound) {
                document.getElementById('soundToggle').classList.add('active');
            } else {
                document.getElementById('soundToggle').classList.remove('active');
            }
            
            // è‡ªåŠ¨ä¿å­˜
            if (settings.autoSave) {
                document.getElementById('autoSaveToggle').classList.add('active');
            } else {
                document.getElementById('autoSaveToggle').classList.remove('active');
            }
            
            // é»˜è®¤æ¨¡å¼
            document.getElementById('defaultModeSelect').value = settings.defaultMode;
        }

        // æ’­æ”¾æç¤ºéŸ³
        function playNotificationSound() {
            if (!settings.sound) return;
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleQUNfLvY3pZXGBp2tdrhsmI0JXmp0NyxZD1BdJ7F0K14WFNKXHW22dqtfXZwZFRdaJa7rXMaDjRupNvklFsDBj6W0OmpZgIASJvS6KRZDQBOm83omFcLAE2azeiVVgkAT5rN6JdYCwBOms3omFcLAE2azeiWVwoAT5rN6JdYCwBNms3ol1cLAE6azeiXVwsATprN6JdXCwBNms3ol1cLAE6azeiXWAsATZrN6JdXCwBOms3ol1cLAE2azeiXVwsATprN6JdXCwBNms3olw==');
                audio.volume = 0.3;
                audio.play().catch(() => {});
            } catch(e) {}
        }

        // åˆ‡æ¢æ·±è‰²æ¨¡å¼
        function toggleDarkMode() {
            settings.darkMode = !settings.darkMode;
            applySettings();
            saveSettings();
        }

        // åˆ‡æ¢æç¤ºéŸ³
        function toggleSound() {
            settings.sound = !settings.sound;
            applySettings();
            saveSettings();
        }

        // åˆ‡æ¢è‡ªåŠ¨ä¿å­˜
        function toggleAutoSave() {
            settings.autoSave = !settings.autoSave;
            applySettings();
            saveSettings();
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
